# Nginx vhost for Holy-Unblocker at epicrobot.zapto.org
# Upstream set to 127.0.0.1:8082 (adjust if your HU is different).

map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}

server {
  listen 80;
  listen [::]:80;
  server_name epicrobot.zapto.org;

  # Allow ACME HTTP-01 challenges on :80
  location ^~ /.well-known/acme-challenge/ {
    default_type text/plain;
    root /var/www/html; # adjust if your ACME client expects another path
  }

  # Redirect all other HTTP traffic to HTTPS (post-cert issuance). This does not
  # interfere with ACME HTTP-01 due to the location block above.
  location / {
    return 301 https://$host$request_uri;
  }
}

# Optional HTTPS server block (enable after issuing certificates)
# Using certbot --nginx is recommended to generate and inject correct paths.
# Uncomment and adjust the ssl_certificate paths once issued by Letâ€™s Encrypt.
#
# server {
#   listen 443 ssl http2;
#   listen [::]:443 ssl http2;
#   server_name epicrobot.zapto.org;
#
#   ssl_certificate /etc/letsencrypt/live/epicrobot.zapto.org/fullchain.pem;
#   ssl_certificate_key /etc/letsencrypt/live/epicrobot.zapto.org/privkey.pem;
#   include /etc/letsencrypt/options-ssl-nginx.conf; # if available
#   # ssl_stapling on; ssl_stapling_verify on; # optional if your chain supports OCSP
#
#   # HSTS intentionally disabled by default to avoid lock-in; enable if desired:
#   # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
#
#   location / {
#     proxy_pass http://127.0.0.1:8082;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection $connection_upgrade;
#     proxy_read_timeout 75s;
#     proxy_send_timeout 75s;
#   }
# }
